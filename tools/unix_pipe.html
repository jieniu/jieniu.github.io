<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【译】Unix 管道之美 | 程序员在深圳</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="一个程序员的工作学习日志">
    
    <link rel="preload" href="/assets/css/0.styles.f5338f93.css" as="style"><link rel="preload" href="/assets/js/app.df58ad8f.js" as="script"><link rel="preload" href="/assets/js/2.61eaf15d.js" as="script"><link rel="preload" href="/assets/js/70.6b66c1a9.js" as="script"><link rel="prefetch" href="/assets/js/10.f87ecc1f.js"><link rel="prefetch" href="/assets/js/11.54366349.js"><link rel="prefetch" href="/assets/js/12.67a0f6b0.js"><link rel="prefetch" href="/assets/js/13.99b5efa8.js"><link rel="prefetch" href="/assets/js/14.d6c4161c.js"><link rel="prefetch" href="/assets/js/15.86108684.js"><link rel="prefetch" href="/assets/js/16.010195ae.js"><link rel="prefetch" href="/assets/js/17.ce5baee3.js"><link rel="prefetch" href="/assets/js/18.aadd0b94.js"><link rel="prefetch" href="/assets/js/19.572b0672.js"><link rel="prefetch" href="/assets/js/20.b6be1672.js"><link rel="prefetch" href="/assets/js/21.cd98384f.js"><link rel="prefetch" href="/assets/js/22.102317c8.js"><link rel="prefetch" href="/assets/js/23.a0861652.js"><link rel="prefetch" href="/assets/js/24.bf902e0e.js"><link rel="prefetch" href="/assets/js/25.07e70736.js"><link rel="prefetch" href="/assets/js/26.3217ccfc.js"><link rel="prefetch" href="/assets/js/27.234cd32e.js"><link rel="prefetch" href="/assets/js/28.7c7054a6.js"><link rel="prefetch" href="/assets/js/29.f9081eeb.js"><link rel="prefetch" href="/assets/js/3.b3b53faa.js"><link rel="prefetch" href="/assets/js/30.8e61b67c.js"><link rel="prefetch" href="/assets/js/31.6c587718.js"><link rel="prefetch" href="/assets/js/32.dc610c44.js"><link rel="prefetch" href="/assets/js/33.dcbd6e39.js"><link rel="prefetch" href="/assets/js/34.ae1fd795.js"><link rel="prefetch" href="/assets/js/35.138d4346.js"><link rel="prefetch" href="/assets/js/36.d31f5a6a.js"><link rel="prefetch" href="/assets/js/37.a3169296.js"><link rel="prefetch" href="/assets/js/38.aca3097a.js"><link rel="prefetch" href="/assets/js/39.c0de7ac0.js"><link rel="prefetch" href="/assets/js/4.e59358e7.js"><link rel="prefetch" href="/assets/js/40.5d68e63a.js"><link rel="prefetch" href="/assets/js/41.3dca7ff0.js"><link rel="prefetch" href="/assets/js/42.315116b4.js"><link rel="prefetch" href="/assets/js/43.cef3d9f5.js"><link rel="prefetch" href="/assets/js/44.88ac8ba1.js"><link rel="prefetch" href="/assets/js/45.73ffc9a4.js"><link rel="prefetch" href="/assets/js/46.04780877.js"><link rel="prefetch" href="/assets/js/47.f20a8844.js"><link rel="prefetch" href="/assets/js/48.e649e8cd.js"><link rel="prefetch" href="/assets/js/49.8a3b5784.js"><link rel="prefetch" href="/assets/js/5.1b393789.js"><link rel="prefetch" href="/assets/js/50.1a49c4ab.js"><link rel="prefetch" href="/assets/js/51.cbf7b21b.js"><link rel="prefetch" href="/assets/js/52.7788643e.js"><link rel="prefetch" href="/assets/js/53.e05e9f77.js"><link rel="prefetch" href="/assets/js/54.afd8b938.js"><link rel="prefetch" href="/assets/js/55.563d7429.js"><link rel="prefetch" href="/assets/js/56.b7fa3e85.js"><link rel="prefetch" href="/assets/js/57.f1a89935.js"><link rel="prefetch" href="/assets/js/58.15388447.js"><link rel="prefetch" href="/assets/js/59.372e5f15.js"><link rel="prefetch" href="/assets/js/6.b798fcf5.js"><link rel="prefetch" href="/assets/js/60.a488faa3.js"><link rel="prefetch" href="/assets/js/61.76dadce9.js"><link rel="prefetch" href="/assets/js/62.21c77b63.js"><link rel="prefetch" href="/assets/js/63.5e49c47d.js"><link rel="prefetch" href="/assets/js/64.453510d9.js"><link rel="prefetch" href="/assets/js/65.993d90cc.js"><link rel="prefetch" href="/assets/js/66.4cab5d50.js"><link rel="prefetch" href="/assets/js/67.868bf75e.js"><link rel="prefetch" href="/assets/js/68.89613fc8.js"><link rel="prefetch" href="/assets/js/69.779e7f70.js"><link rel="prefetch" href="/assets/js/7.cb2f8a10.js"><link rel="prefetch" href="/assets/js/71.9783ef6a.js"><link rel="prefetch" href="/assets/js/72.5e7137bc.js"><link rel="prefetch" href="/assets/js/73.9fcb00bc.js"><link rel="prefetch" href="/assets/js/74.3a440a9c.js"><link rel="prefetch" href="/assets/js/8.01f6304b.js"><link rel="prefetch" href="/assets/js/9.e15aa5e8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f5338f93.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">程序员在深圳</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cpp/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/AI/" class="nav-link">
  AI
</a></div><div class="nav-item"><a href="/math/" class="nav-link">
  math
</a></div><div class="nav-item"><a href="/mysql_notes/" class="nav-link">
  mysql
</a></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  tools
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode/" class="nav-link">
  articles
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/jieniu/LeetCode.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MyLeeCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/jieniu/articles" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cpp/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/AI/" class="nav-link">
  AI
</a></div><div class="nav-item"><a href="/math/" class="nav-link">
  math
</a></div><div class="nav-item"><a href="/mysql_notes/" class="nav-link">
  mysql
</a></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  tools
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode/" class="nav-link">
  articles
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/jieniu/LeetCode.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MyLeeCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/jieniu/articles" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="【译】unix-管道之美"><a href="#【译】unix-管道之美" class="header-anchor">#</a> 【译】Unix 管道之美</h1> <blockquote><p>by Prithu Goswami</p> <p>原文链接：https://prithu.xyz/posts/unix-pipeline/</p></blockquote> <p>Unix 哲学强调构建简单且可扩展的软件。每一个软件只做一件事情，并把这件事做好。同时该软件还可以通过“文本流”（text stream）和其他软件进行交互，这一点也是让 Unix 如此强大且直观的核心理念之一。</p> <p>引用 <a href="https://en.wikipedia.org/wiki/The_UNIX_Programming_Environment" target="_blank" rel="noopener noreferrer">Unix 编程环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的一段内容：</p> <blockquote><p>尽管 Unix 系统中引入了许多创新的程序和技术，但单个程序或想法并不能让它很好的工作。事实上，让 Unix 更高效的是编程的方法，是一种使用计算机的哲学。虽然这些哲学无法用一句话来描述，但它的核心在于：一个系统的力量更多的来自于程序之间的关系，而不是程序本身。很多孤立的 Unix 程序仅能完成相当简单的工作，但将它们组合起来，就成了通用且好用的工具。</p></blockquote> <p>我想这段话已经解释得很好了。同样，你还可以观看 <a href="https://youtu.be/tc4ROCJYbm0?t=297" target="_blank" rel="noopener noreferrer">Brian Kernighan<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 解释 Unix 操作系统的基本原理，他还介绍了一个使用管道的例子。</p> <p>在本文中，我想向大家展示这一理念的几个实例——如何组合不同的 unix 工具来完成一些强大的任务。</p> <p>例子：</p> <ul><li>基于 git 仓库中的提交日志，产生作者的提交排行榜</li> <li>浏览 <a href="https://reddit.com/r/memes" target="_blank" rel="noopener noreferrer">/r/meme<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的表情图片和根据 <a href="https://reddit.com/r/earthporn" target="_blank" rel="noopener noreferrer">/r/earthporn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 设置你的桌面</li> <li>随机从 IMDB 中挑选一部影片</li></ul> <h2 id="例子1-基于-git-仓库中的提交日志-产生作者的提交排行榜"><a href="#例子1-基于-git-仓库中的提交日志-产生作者的提交排行榜" class="header-anchor">#</a> 例子1 - 基于 git 仓库中的提交日志，产生作者的提交排行榜</h2> <p>我们先从简单的开始 - 打印 git 仓库的作者/贡献者列表，并按照提交次数作降序排序（贡献最多的排在前面）。对于 pipeline 来说，这是个简单的任务。<code>git log</code> 命令可以打印提交日志，我们可以添加 <code>--format=&lt;format&gt;</code> 选项来控制想要打印的格式，<code>--format='%an'</code> 表示仅输出每次提交中作者的名字。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> log --format<span class="token operator">=</span><span class="token string">'%an'</span>
Alice
Bob
Denise
Denise
Candice
Denise
Alice
Alice
Alice
</code></pre></div><p>现在我们使用 <code>sort</code> 功能将作者按照字母顺序进行排序</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> log --format<span class="token operator">=</span><span class="token string">'%an'</span> <span class="token operator">|</span> <span class="token function">sort</span>
Alice
Alice
Alice
Alice
Bob
Candice
Denise
Denise
Denise
</code></pre></div><p>将结果输入到 <code>uniq</code> 中</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> log --format<span class="token operator">=</span><span class="token string">'%an'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> -c
    <span class="token number">4</span> Alice
    <span class="token number">1</span> Bob
    <span class="token number">1</span> Candice
    <span class="token number">3</span> Denise
</code></pre></div><p>来看一下 <code>uniq</code> 的操作手册：</p> <blockquote><p>uniq - 报告或忽略重复的行</p> <p>从输入文件或者标准输入中过滤相邻的匹配行并写入到输出文件或标准输出。</p></blockquote> <p>所以 <code>uniq</code> 会过滤掉重复的行，不过前提是这些重复的行要相邻，这也是为什么我们首先要将数据输入到 <code>sort</code> 中。<code>-c</code> 选项会在每行行首展示重复的次数。</p> <p>你可以看到输出依然是按照字幕顺序排列的，现在剩下的就是按数值进行排序了。<code>sort</code> 有一个<code>-n</code> 选项，它会考虑数值排序这件事。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> log --format<span class="token operator">=</span><span class="token string">'%an'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> -c <span class="token operator">|</span> <span class="token function">sort</span> -nr
    <span class="token number">4</span> Alice
    <span class="token number">3</span> Denise
    <span class="token number">1</span> Candice
    <span class="token number">1</span> Bob
</code></pre></div><p><code>sort</code> 默认会按升序排序，加上 <code>-r</code> 选项后，便会按照逆序来排序。于是，这就是你想要的 -- 根据提交次数排序的作者榜单。</p> <h2 id="例子-2-浏览-r-meme-中的表情图片和根据-r-earthporn-设置你的桌面"><a href="#例子-2-浏览-r-meme-中的表情图片和根据-r-earthporn-设置你的桌面" class="header-anchor">#</a> 例子 2 - 浏览 <a href="https://reddit.com/r/memes" target="_blank" rel="noopener noreferrer">/r/meme<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的表情图片和根据 <a href="https://reddit.com/r/earthporn" target="_blank" rel="noopener noreferrer">/r/earthporn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 设置你的桌面</h2> <p>你知道吗，你可以添加 &quot;<code>.json</code>&quot; 到 reddit 的网址尾部，以获得一个 json 响应，而不是通常的 html 页面。这让我们可以做很多事情，其中之一就是直接从命令行浏览表情包（好吧，不完全是，因为实际的图像将显示在GUI程序上）。我们可以简单地通过 curl 或 wget 来获取 -- https://reddit.com/r/memes.json。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">wget</span> -O - -q <span class="token string">'https://reddit.com/r/memes.json'</span>

<span class="token string">'{&quot;kind&quot;: &quot;Listing&quot;, &quot;data&quot;: {&quot;modhash&quot;: &quot;xyloiccqgm649f320569f4efb427cdcbd89e68aeceeda8fe1a&quot;, &quot;dist&quot;: 27, &quot;children&quot;:
[{&quot;kind&quot;: &quot;t3&quot;, &quot;data&quot;: {&quot;approved_at_utc&quot;: null, &quot;subreddit&quot;: &quot;memes&quot;,
&quot;selftext&quot;: &quot;More info available at....'</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
More lines
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
</code></pre></div><p><em>译者注：国内如不能正常访问，可以使用 proxychains4</em></p> <p>我在这里使用 wget 是因为 Curl User-Agent 似乎得到了不同的处理。显然，你可以通过简单地改变 &quot;User-Agent&quot; 来解决这个问题，但我还是决定用 <code>wget</code>。wget 通过 <code>-O</code> 选项来获取输出文件名。大多数程序都支持 <code>-</code> 值，来表示标准输入输出。<code>-q</code> 选项表示安静的输出，不要打印进度之类的信息。现在我们拿到了一个大 json，为了在命令行中解析和使用这些 JSON 数据，我们可以使用 <code>jq</code>。<code>jq</code> 可以被认为是 JSON 的 <code>sed/awk</code>，它也是一门简单直观的语言，你可以参考它的操作手册。</p> <p>返回的 JSON 看上去像这样：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Listing&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;modhash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;awe40m26lde06517c260e2071117e208f8c9b5b29e1da12bf7&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;dist&quot;</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
        <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;after&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t3_gi892x&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;before&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以我们拿到的响应类型为 &quot;Listing&quot;，从中，我们还可以看到一个 &quot;children&quot; 数组，&quot;children&quot; 数组中的每一个元素表示一个帖子（post），它们看上去像这样：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;subreddit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;memes&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;selftext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token number">1589309289</span><span class="token punctuation">,</span>
        <span class="token property">&quot;author_fullname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t2_4amm4a5w&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;gilded&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Its hard to argue with his assessment&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;subreddit_name_prefixed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;r/memes&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;downs&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hide_score&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t3_gi8wkj&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;quarantine&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;permalink&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/r/memes/comments/gi8wkj/its_hard_to_argue_with_his_assessment/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://i.redd.it/6vi05eobdby41.jpg&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;upvote_ratio&quot;</span><span class="token operator">:</span> <span class="token number">0.93</span><span class="token punctuation">,</span>
        <span class="token property">&quot;subreddit_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ups&quot;</span><span class="token operator">:</span> <span class="token number">11367</span><span class="token punctuation">,</span>
        <span class="token property">&quot;total_awards_received&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;score&quot;</span><span class="token operator">:</span> <span class="token number">11367</span><span class="token punctuation">,</span>
        <span class="token property">&quot;author_premium&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;thumbnail&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://b.thumbs.redditmedia.com/QZt8_SBJDdKLVnXK8P4Wr_02ALEhGoGFEeNhpsyIfvw.jpg&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;gildings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;post_hint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span>

        <span class="token string">&quot;..................&quot;</span>
        <span class="token string">&quot;more lines skipped&quot;</span>
        <span class="token string">&quot;..................&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面我省掉了 <code>data</code> 中的一些信息，其中一共有 105 个条目，你可以从中拿到很多有趣的数据，而当前我们只关心 <code>url</code> 这一项。它不是 reddit 帖子的 url，而是帖子内容的 url。如果你想要的是帖子的 url，就使用 <code>permalink</code>。所以在本例中，<code>url</code> 字段是表情图片的链接。</p> <p>我们可以非常简单的就获取其中所有的 urls：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">wget</span> -O - -q reddit.com/r/memes.json <span class="token operator">|</span> jq <span class="token string">'.data.children[] |.data.url'</span>

<span class="token string">&quot;https://www.reddit.com/r/memes/comments/g9w9bv/join_the_unofficial_redditmc_minecraft_server_at/&quot;</span>
<span class="token string">&quot;https://www.reddit.com/r/memes/comments/ggsomm/10_million_subscriber_event/&quot;</span>
<span class="token string">&quot;https://i.imgur.com/KpwIuSO.png&quot;</span>
<span class="token string">&quot;https://i.redd.it/ey1f7ksrtay41.jpg&quot;</span>
<span class="token string">&quot;https://i.redd.it/is3cckgbeby41.png&quot;</span>
<span class="token string">&quot;https://i.redd.it/4pfwbtqsaby41.jpg&quot;</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
</code></pre></div><p>忽略掉前两条链接，那基本上是版主放的贴子，其 &quot;url&quot; 形式和 &quot;permalink&quot; 是一样的。</p> <p>输入我们之前看到的 JSON 到<code>jq</code> 中，然后<code>.data.children</code> 指的是之前提到的帖子数组。<code>.data.children[] | .data.url</code> 的意思是：&quot;遍历数组中的每个元素，并打印每个元素的 'data' 字段中的 'url'&quot;。</p> <p>所以我们得到了 <a href="https://reddit.com/r/memes" target="_blank" rel="noopener noreferrer">/r/memes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中所有 “热门” 帖子的 URLs 列表。如果你想得到本周的 &quot;热门 &quot;帖子，那么你可以输入 https://reddit.com/r/memes/top.json?t=week。想拿到所有时间的热门帖子怎么办？<code>t=all</code>，一年的呢？ <code>t=year</code>，以此类推。</p> <p>一旦我们有了所有 URL 的列表，我们就可以直接将其导入 <code>xargs</code>。Xargs 是一个非常有用的工具，可以从标准输入中构建命令行。以下是 xarg 手册中的内容：</p> <blockquote><p>xargs 从标准输入中读取条目（items），它们以空格或换行符来分隔，然后一次或多次的执行命令（默认为 /bin/echo），命令的参数为初始参数加上从标准输入中读取的条目。标准输入的空行将被忽略。</p></blockquote> <p>所以执行</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;https://i.redd.it/4pfwbtqsaby41.jpg&quot;</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">wget</span> -O meme.jpg -q
</code></pre></div><p>等价于执行：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">wget</span> -O meme.jpg -q <span class="token string">&quot;https://i.redd.it/4pfwbtqsaby41.jpg&quot;</span>
</code></pre></div><p>现在我们可将 URL 列表输入到一个图片浏览器，如 <code>feh</code> 或 <code>eog</code>。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">wget</span> -O - -q reddit.com/r/memes.json <span class="token operator">|</span> jq <span class="token string">'.data.children[] |.data.url'</span> <span class="token operator">|</span> <span class="token function">xargs</span> feh
</code></pre></div><p><em>译者注：无法正常访问的同学可在 feh 前加上 proxychains4</em></p> <p>于是表情图片弹了出来，我可以像在本地磁盘上一样用方向键浏览它们。</p> <p><img src="https://prithu.xyz/posts/unix-pipeline/feh-meme.png" alt="img"></p> <p>或者我可以用 <code>wget</code> 来替换 <code>feh</code>，然后把这些图片都下载下来。</p> <p>你可以用它来做任何事情，reddit JSON 数据的另一个用例是：使用热门板块 <a href="https://reddit.com/r/earthporn" target="_blank" rel="noopener noreferrer">/r/earthporn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中点赞数最多的图片来设置你的桌面。</p> <div class="language- extra-class"><pre class="language-text"><code>$ wget -O - -q reddit.com/r/earthporn.json | jq '.data.children[] |.data.url' | head -1 | xargs feh --bg-fill
</code></pre></div><p>如果你愿意的话，你可以把这个设置成每小时运行一次的 cron-job。我在这里使用 <code>head</code> 命令只打印第一行，也就是被投票最多的帖子。就其本身而言，head似乎做了一些很琐碎、很无用的事情，但在这种情况下，与其他程序一起工作，它就成了一个重要的部分。</p> <p>你看到 Unix 管道的威力了吗？这一行就完成了从获取 JSON 数据，解析并从中读取相关数据，然后再次根据 URL 获取图片，最后将其设置为壁纸的所有工作。</p> <p>我用它做的另一件傻事就是每两个小时从 /r/memes 上下载表情包。这在我的机器上被设置为一个 cron job。现在我有大约 19566 个表情，占用了我磁盘的 4.5G 空间。我为什么要这么做？别问我...</p> <h2 id="例子-3-随机从-imdb-中挑选一部影片"><a href="#例子-3-随机从-imdb-中挑选一部影片" class="header-anchor">#</a> 例子 3 - 随机从 IMDB 中挑选一部影片</h2> <p>最后用一个简单的例子结束吧。IMDb 有一个功能，他们允许你制作电影列表，你也可以找到其他用户制作的列表。例如 - <a href="https://www.imdb.com/list/ls020046354" target="_blank" rel="noopener noreferrer">Blow Your Mind Movies<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。如果你在该网址后面附加一个 <code>/export</code> ，你将得到该列表的  <code>.csv</code>  格式的输出。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://www.imdb.com/list/ls020046354/export

Position,Const,Created,Modified,Description,Title,URL,Title Type,IMDb Rating,Runtime <span class="token punctuation">(</span>mins<span class="token punctuation">)</span>,Year,Genres,Num Votes,Release Date,Directors
<span class="token number">1</span>,tt0137523,2017-07-30,2017-07-30,,Fight Club,https://www.imdb.com/title/tt0137523/,movie,8.8,139,1999,Drama,1780706,1999-09-10,David Fincher
<span class="token number">2</span>,tt0945513,2017-07-30,2017-07-30,,Source Code,https://www.imdb.com/title/tt0945513/,movie,7.5,93,2011,<span class="token string">&quot;Action, Drama, Mystery, Sci-Fi, Thriller&quot;</span>,471234,2011-03-11,Duncan Jones
<span class="token number">3</span>,tt0482571,2017-07-30,2017-07-30,,The Prestige,https://www.imdb.com/title/tt0482571/,movie,8.5,130,2006,<span class="token string">&quot;Drama, Mystery, Sci-Fi, Thriller&quot;</span>,1133548,2006-10-17,Christopher Nolan
<span class="token number">4</span>,tt0209144,2018-01-16,2018-01-16,,Memento,https://www.imdb.com/title/tt0209144/,movie,8.4,113,2000,<span class="token string">&quot;Mystery, Thriller&quot;</span>,1081848,2000-09-05,Christopher Nolan
<span class="token number">5</span>,tt0144084,2018-01-16,2018-01-16,,American Psycho,https://www.imdb.com/title/tt0144084/,movie,7.6,101,2000,<span class="token string">&quot;Comedy, Crime, Drama&quot;</span>,462984,2000-01-21,Mary Harron
<span class="token number">6</span>,tt0364569,2018-01-16,2018-01-16,,Oldeuboi,https://www.imdb.com/title/tt0364569/,movie,8.4,120,2003,<span class="token string">&quot;Action, Drama, Mystery, Thriller&quot;</span>,491476,2003-11-21,Chan-wook Park
<span class="token number">7</span>,tt1130884,2018-10-08,2018-10-08,,Shutter Island,https://www.imdb.com/title/tt1130884/,movie,8.1,138,2010,<span class="token string">&quot;Mystery, Thriller&quot;</span>,1075524,2010-02-13,Martin Scorsese
<span class="token number">8</span>,tt8772262,2019-12-27,2019-12-27,,Midsommar,https://www.imdb.com/title/tt8772262/,movie,7.1,148,2019,<span class="token string">&quot;Drama, Horror, Mystery, Thriller&quot;</span>,150798,2019-06-24,Ari Aster
</code></pre></div><p>使用 <code>cut</code> 命令输出我们关心的列：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://www.imdb.com/list/ls020046354/export <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">','</span> -f <span class="token number">6</span>

Title
Fight Club
Source Code
The Prestige
Memento
American Psycho
Oldeuboi
Shutter Island
Midsommar
</code></pre></div><p>选项 <code>-d</code> 用来指定每个字段的分隔符。字段之间用什么分隔？在本例中，它是一个逗号（<code>,</code>）。<code>-f</code> 选项是你想要打印的字段序号。本例中，第 6 个字段是电影的标题。但这样做字段标题 &quot;Title&quot; 也会被打印出来，所以要删除它，我们可以使用 <code>sed '1 d'</code> 命令，它的意思是，从输入流中删除第 1 行。</p> <p>接下来把电影列表输入到 <code>shuf</code> 中，<code>shuf</code> 做的事情是将列表随机打乱，然后输出：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://www.imdb.com/list/ls020046354/export <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">','</span> -f <span class="token number">6</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1 d'</span> <span class="token operator">|</span> <span class="token function">shuf</span>

American Psycho
Midsommar
Source Code
Oldeuboi
Fight Club
Memento
Shutter Island
The Prestige
</code></pre></div><p>接着把它输入到 <code>head -1</code> 或 <code>sed '1 q'</code>，仅输出第 1 行。于是每次运行这行命令，你会得到一个随机的电影名</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://www.imdb.com/list/ls020046354/export <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">','</span> -f <span class="token number">6</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1 d'</span> <span class="token operator">|</span> <span class="token function">shuf</span> <span class="token operator">|</span> <span class="token function">head</span> -1

Source Code
</code></pre></div><p>如果你还想输出电影的详情页链接，没问题，通过 <code>--field=LIST</code> 选项，<code>cut</code> 允许你输出列表中的多个字段</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://www.imdb.com/list/ls020046354/export <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">','</span> --field<span class="token operator">=</span><span class="token number">6,7</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1 d'</span> <span class="token operator">|</span> <span class="token function">shuf</span> <span class="token operator">|</span> <span class="token function">head</span> -1

Shutter Island,https://www.imdb.com/title/tt1130884/
</code></pre></div><p>不过这里还有一个问题，如果电影标题中有逗号，那么你会得到一个完全不同的字段值。解决该问题的一个方法是使用 python 单行代码：</p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>c <span class="token string">'import csv,sys;[print (a[&quot;Title&quot;]) for a in csv.DictReader(sys.stdin)]'</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> -s https://www.imdb.com/list/ls020046354/export <span class="token operator">|</span><span class="token punctuation">\</span>
    python -c <span class="token string">'import csv,sys;[print (a[&quot;Title&quot;],a[&quot;URL&quot;]) for a in csv.DictReader(sys.stdin)]'</span><span class="token operator">|</span><span class="token punctuation">\</span>
    <span class="token function">shuf</span> <span class="token operator">|</span> <span class="token function">head</span> -1

Oldeuboi https://www.imdb.com/title/tt0364569/ 
</code></pre></div><p>以上仅仅是几个例子，然而，用一行 shell 命令，可以完成的事情还有很多。</p> <p>继续查看 Hacker News 上的<a href="https://news.ycombinator.com/item?id=23420786" target="_blank" rel="noopener noreferrer">讨论<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/jieniu/articles/edit/master/docs/tools/unix_pipe.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.df58ad8f.js" defer></script><script src="/assets/js/2.61eaf15d.js" defer></script><script src="/assets/js/70.6b66c1a9.js" defer></script>
  </body>
</html>
